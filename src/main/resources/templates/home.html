<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Home Page</title>
    <link rel="stylesheet" th:href="@{/home.css}">
</head>
<body>
<div class="container">
    <h1>Welcome to Your Dashboard!</h1>

    <!-- LESSONS -->
    <div class="card">
        <h2>Lessons</h2>
        <a th:href="@{/lessons/create}" class="btn create-lesson">
            ➕ Create Lesson
        </a>

        <div th:if="${homePageData.lessons != null and homePageData.lessons.lessons.size() > 0}">
            <div th:each="lesson : ${homePageData.lessons.lessons}"
                 class="card-content"
                 th:onclick="'openLessonModal(' + ${lesson.id} + ')'"
                 style="cursor:pointer;">
                <strong class="lesson-date" th:data-date="${lesson.dateUtc}"></strong><br>

                <span th:if="${lesson.groupName != null}" th:text="${lesson.groupName}"></span>
                <span th:if="${lesson.groupName == null}" th:text="${#strings.arrayJoin(lesson.studentNames.toArray(), ', ')}"></span>

                <span th:text="${lesson.status}"
                      th:class="'badge badge-' + ${lesson.status.name().toLowerCase()}">
                </span>
            </div>
        </div>
        <p th:if="${homePageData.lessons == null or homePageData.lessons.lessons.size() == 0}">No lessons found.</p>
    </div>

    <!-- HOMEWORKS -->
    <div class="card">
        <h2>Homeworks</h2>
        <div th:if="${homePageData.homeworks != null and homePageData.homeworks.homeworks.size() > 0}">
            <div th:each="homework : ${homePageData.homeworks.homeworks}" class="card-content">
                <span th:text="'Lesson ID: ' + ${homework.lessonId}"></span> /
                <span th:text="${homework.status}" th:class="'badge badge-' + ${homework.status.name().toLowerCase()}"></span>
            </div>
        </div>
        <p th:if="${homePageData.homeworks == null or homePageData.homeworks.homeworks.size() == 0}">No homeworks found.</p>
    </div>
</div>

<!-- MODAL -->
<div id="lessonModal" class="modal">
    <button onclick="closeModal()" class="close-btn">✖</button>
    <h2>Lesson Info</h2>
    <p><strong>Teacher:</strong> <span id="modal-teacher"></span></p>
    <p><strong>Group:</strong> <span id="modal-group"></span></p>
    <p><strong>Students:</strong> <span id="modal-students"></span></p>
    <p><strong>Status:</strong> <span id="modal-status" class="badge"></span></p>

    <label for="statusSelect">Update Lesson Status:</label>
    <select id="statusSelect">
        <option value="PLANNED">PLANNED</option>
        <option value="COMPLETED">COMPLETED</option>
        <option value="CANCELLED">CANCELLED</option>
    </select>

    <div id="cancelFields" style="margin-top:10px; display:none;">
        <label for="cancelledBySelect">Cancelled By:</label>
        <select id="cancelledBySelect">
            <option value="TEACHER">TEACHER</option>
            <option value="STUDENT">STUDENT</option>
        </select>

        <label for="cancelReasonSelect">Reason:</label>
        <select id="cancelReasonSelect">
            <option value="VALID_REASON">VALID_REASON</option>
            <option value="INVALID_REASON">INVALID_REASON</option>
        </select>
    </div>

    <h3>Attendance</h3>
    <div id="attendanceFields"></div>

    <button onclick="updateLesson()" style="margin-top:10px;">Update</button>
</div>

<div id="modalOverlay" class="modal-overlay" onclick="closeModal()"></div>

<!-- External JS -->
<script th:src="@{/lesson-modal.js}"></script>
</body>
</html>